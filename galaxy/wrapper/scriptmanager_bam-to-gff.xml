<tool id="scriptmanager_bam-to-gff" name="ScriptManager: Convert BAM to GFF" version="0.1.0" profile="22.01" >
    <description> Convert BAM file to GFF file </description>
    <macros>
        <import>scriptmanager_macros.xml</import>
    </macros>
    <requirements>
        <expand macro="requirement_openjdk" />
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$BAM' bamfile.bam &&
        ln -s '$output1' output1.gff &&
        #if $BAM.is_of_type('bam'):
            #if str( $BAM.metadata.bam_index ) != "None":
                    ln -s '${BAM.metadata.bam_index}' bamfile.bam.bai &&
            #else:
                    samtools index bamfile.bam bamfile.bai &&
            #end if
        #end if

        java -jar $__tool_directory__/@JAR_FILENAME@ bam-format-converter bam-to-gff

        #if str($read) == "read_1" :
            -1
        #else if str($read) == "read_2" :
            -2
        #else if str($read) == "combined" :
            -a
        #else if str($read) == "midpoint" :
            -m
        #else if str($read) == "fragment" :
            -f
        #end if

        #if str($mate_pair) == "Yes" :
            -p
        #end if

        #if str($filter_by_min.filter_min) == "Yes" :
            -n "$filter_by_min.min_insert"
        #end if

        -o output1.gff

        #if str($filter_by_max.filter_max) == "Yes" :
            -x "$filter_by_max.max_insert"
        #end if

        bamfile.bam
    ]]></command>
    <inputs>
        <param type="data" name="BAM" format="bam" label="Input BAM file"/>

        <param type="select" name="read" label="Select which read to output">
            <option value="read_1" selected="True" >Read 1</option>
            <option value="read_2" >Read 2</option>
            <option value="combined" >Combined </option>
            <option value="midpoint" >Midpoint (Require PE) </option>
            <option value="fragment" >Fragment (Require PE) </option>
        </param>

        <param type="boolean" name="mate_pair" truevalue="Yes" falsevalue="No" label="Require proper mate-pair" />

        <conditional name="filter_by_min">
        <param type="boolean" name="filter_min" truevalue="Yes" falsevalue="No" label="Filter by min insert size (bp)" >
            </param>
            <when value="Yes">
                <param type="integer" name="min_insert" value="0" label="Min insert size (bp)" />
            </when>
            <when value="No">
            </when>
        </conditional>

        <conditional name="filter_by_max">
        <param type="boolean" name="filter_max" truevalue="Yes" falsevalue="No" label="Filter by max insert size (bp)" >
        </param>
            <when value="Yes">
                <param type="integer" name="max_insert" value="1000" label="Max insert size (bp)" />
            </when>
            <when value="No">
            </when>
        </conditional>


    </inputs>
    <outputs>
        <data name="output1" format="gff" label="${tool.name} (composite) on ${on_string}"></data>
    </outputs>
    <help>
**What it does**

Convert BAM file to GFF file.
    </help>
    <expand macro="citations_pearc" />
</tool>
